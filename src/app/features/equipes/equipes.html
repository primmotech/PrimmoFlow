<div class="mobile-wrapper" [class.dark-mode]="themeService.darkMode()">
  
  <header class="app-header-compact">
    <div class="header-main">
      <h1>Gestion Groupes</h1>
      <button class="add-circle-btn" (click)="openCreateModal()">+</button>
    </div>
  </header>

  <main class="container">
    <div class="team-grid">
      @for (team of teams(); track team.id) {
        <div class="team-card" [class.expanded]="expandedTeamId() === team.id">
          <div class="team-card-content" (click)="toggleExpand(team.id)">
            <div class="card-top">
              <h3>{{ team.name }}</h3>
              <div class="card-actions">
                <button class="btn-edit" (click)="openEditModal(team); $event.stopPropagation()">✎</button>
                <button class="btn-del" (click)="deleteTeam(team); $event.stopPropagation()">✕</button>
              </div>
            </div>
            <div class="card-meta">
              <span>{{ team.members?.length || 0 }} membre(s)</span>
              <span class="chevron" [class.up]="expandedTeamId() === team.id">▼</span>
            </div>
          </div>

          @if (expandedTeamId() === team.id) {
            <div class="team-details animate-slide-down">
              @for (m of team.members; track m) {
                <div class="member-row"><span class="dot"></span> {{ m }}</div>
              }
            </div>
          }
        </div>
      }
    </div>
  </main>

  @if (showModal()) {
    <div class="modal-full">
      <header class="modal-header-fixed">
        <input type="text" [(ngModel)]="newTeam.name" placeholder="Nom du groupe..." class="ghost-input">
        <button class="close-modal" (click)="showModal.set(false)">✕</button>
      </header>

      <div class="sharing-layout modal-body-sharing">
        <aside class="alphabet-sidebar">
          @for (letter of alphabet; track letter) {
            <span (click)="scrollToLetter(letter)">{{ letter }}</span>
          }
        </aside>

        <div class="scroll-content" id="modalScrollContainer">
          @for (group of groupedTechnicians(); track group.letter) {
            <div class="group-section" [id]="'letter-' + group.letter">
              <h2 class="letter-header">{{ group.letter }}</h2>
              @for (t of group.members; track t.email) {
                <div class="colleague-row" 
                     [class.selected]="newTeam.members.includes(t.email)"
                     (click)="toggleMember(t.email)">
                  <span class="status-dot"></span>
                  <span class="full-name">{{ t.name }}</span>
                  
                  @if (newTeam.members.includes(t.email)) {
                    <div class="checkbox-custom">
                      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="3">
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    </div>
                  }
                </div>
              }
            </div>
          }
        </div>
      </div>

      <button class="fab-save" 
              [disabled]="!newTeam.name || newTeam.members.length === 0"
              (click)="saveTeam()">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="3">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        Enregistrer le groupe
      </button>
    </div>
  }

  <nav class="bottom-nav">
    <a (click)="goBack()" class="nav-item">
      <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 6v8H6"/><path d="M10 10l-4 4 4 4"/></svg>
      <span>Retour</span>
    </a>
  </nav>
</div>