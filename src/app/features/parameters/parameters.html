<div class="mobile-wrapper" [class.dark-mode]="themeService.darkMode()">
  <header class="app-header-compact">
    <h1>Paramètres</h1>
    <p>Profil & Configuration</p>
  </header>

  <main class="container" *ngIf="userData()">
    <section class="settings-group">
      <h3>Informations Profil</h3>
      <div class="settings-card profile-form compact">
        
        <div class="form-row">
          <div class="form-field half">
            <label>Nom</label>
            <input type="text" [(ngModel)]="userData().lastname" (ngModelChange)="onFieldChange()" [disabled]="!authService.hasPerm('param_edit_name')">
          </div>
          <div class="form-field half">
            <label>Prénom</label>
            <input type="text" [(ngModel)]="userData().firstname" (ngModelChange)="onFieldChange()" [disabled]="!authService.hasPerm('param_edit_name')">
          </div>
        </div>

        <div class="form-field">
          <label>Surnom (nickName)</label>
          <input type="text" [(ngModel)]="userData().nickName" (ngModelChange)="onFieldChange()" [disabled]="!authService.hasPerm('param_edit_nickname')">
        </div>

        <div class="form-field">
          <label>Téléphone</label>
          <input type="tel" [(ngModel)]="userData().phone" (ngModelChange)="onFieldChange()" [disabled]="!authService.hasPerm('param_edit_phone')">
        </div>

        <div class="form-row">
          <div class="form-field half"><label>Équipe</label><input type="text" [value]="teamName()" disabled class="readonly-input"></div>
          <div class="form-field half"><label>Rôle</label><input type="text" [value]="userData().role" disabled class="readonly-input"></div>
        </div>

        <div class="form-field"><label>Email</label><input type="text" [value]="authService.userEmail()" disabled class="readonly-input"></div>

        <div class="form-field">
          <label>GPS par défaut</label>
          <select [(ngModel)]="userData().gps" (ngModelChange)="onFieldChange()" [disabled]="!authService.hasPerm('param_edit_gps')">
            <option value="maps">Google Maps</option>
            <option value="waze">Waze</option>
            <option value="iphone">Apple Plans</option>
          </select>
        </div>

        <ng-container *ngIf="authService.hasPerm('param_view_costs')">
          <div class="form-row">
            <div class="form-field half">
              <label>Dépl. (€)</label>
              <input type="number" [(ngModel)]="userData().travelCost" (ngModelChange)="onFieldChange()" [disabled]="!authService.hasPerm('param_edit_costs')">
            </div>
            <div class="form-field half">
              <label>Taux (€/h)</label>
              <input type="number" [(ngModel)]="userData().hourlyRate" (ngModelChange)="onFieldChange()" [disabled]="!authService.hasPerm('param_edit_costs')">
            </div>
          </div>

          <div class="form-field">
            <label>Arrondi travail</label>
            <select [(ngModel)]="userData().rounding" (ngModelChange)="onFieldChange()" [disabled]="!authService.hasPerm('param_edit_costs')">
              <option *ngFor="let opt of roundingOptions" [value]="opt">{{ opt }} min</option>
            </select>
          </div>
        </ng-container>
<section class="settings-group">
  <h3>Couleur Personnelle</h3>
  <div class="settings-card color-picker-container">
    <div class="color-preview-wrapper">
      <div class="color-preview-circle" 
           [style.background-color]="userData().customColor"
           [style.box-shadow]="'0 0 20px ' + userData().customColor">
      </div>
      
      <div class="color-info">
        <span class="color-hex">{{ userData().customColor || '#49dd6b' }}</span>
        <p class="color-label">Cette couleur illuminera vos interventions</p>
      </div>

      <div class="color-input-wrapper">
        <button class="btn-change-color">Choisir</button>
        <input 
          type="color" 
          [(ngModel)]="userData().customColor" 
          (ngModelChange)="onFieldChange()"
          class="hidden-color-input"
        >
      </div>
    </div>
  </div>
</section>

<section class="settings-group">
  <h3>Apparence</h3>
  </section>
        <section class="settings-group">
          <h3>Apparence</h3>
          <div class="settings-card">
            <div class="setting-item" (click)="authService.hasPerm('param_edit_theme') ? toggleTheme() : null">
              <div class="setting-info">
                <svg *ngIf="themeService.darkMode()" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                <svg *ngIf="!themeService.darkMode()" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                <span>{{ themeService.darkMode() ? 'Mode Clair' : 'Mode Sombre' }}</span>
              </div>
              <div class="toggle-switch" [class.active]="themeService.darkMode()"><div class="switch-handle"></div></div>
            </div>
          </div>
        </section>

        <div class="card-actions">
          <button (click)="saveProfile()" class="save-button-inline" [class.dirty]="isDirty()" [disabled]="!isDirty() || saving()">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>
            <span>{{ saving() ? 'Sauvegarde...' : 'Sauvegarder' }}</span>
          </button>
        </div>
      </div>
    </section>
  </main>

  <nav class="bottom-nav">
    <a routerLink="/dashboard" class="nav-item">
       <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="8" y1="6" x2="21" y2="6"></line>
        <line x1="8" y1="12" x2="21" y2="12"></line>
        <line x1="8" y1="18" x2="21" y2="18"></line>
        <line x1="3" y1="6" x2="3.01" y2="6"></line>
        <line x1="3" y1="12" x2="3.01" y2="12"></line>
        <line x1="3" y1="18" x2="3.01" y2="18"></line>
      </svg>
      <span>Accueil</span>
    </a>
 
    <a *ngIf="authService.hasPerm('param_panel_equipes')" routerLink="/equipes" routerLinkActive="active" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/></svg>
        <span>Groupes</span>
    </a>
<a routerLink="/partage" routerLinkActive="active" class="nav-item">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
  <circle cx="18" cy="5" r="3" />
  <circle cx="6" cy="12" r="3" />
  <circle cx="18" cy="19" r="3" />
  <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
  <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
</svg>
  <span>Partage</span>
</a>

    <a *ngIf="authService.hasPerm('param_panel_roles')" routerLink="/roles" routerLinkActive="active" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        <span>Rôles</span>
    </a>

    <a *ngIf="authService.hasPerm('param_panel_whitelist')" routerLink="/whitelist" routerLinkActive="active" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>
        <span>Whitelist</span>
    </a>
  </nav>
</div>