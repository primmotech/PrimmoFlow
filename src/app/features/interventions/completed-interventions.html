<div class="mobile-wrapper" [class.dark-mode]="themeService.darkMode()">
  
  <header class="app-header">
    <div class="brand"><h1>Archives ({{ missions().length }})</h1></div>

  </header>

  <main class="container">
    <section class="recent-activity">
      <div class="section-header">
        <h3>Total :  {{ totalRevenu() | number:'1.2-2' }}€</h3>
      </div>

      @if (loading()) {
        <div class="loader-container">
          <div class="spinner"></div>
          <p>Accès aux archives...</p>
        </div>
      } @else {
        <div class="intervention-list">
          @for (m of missions(); track m.$id) {
            <div class="intervention-card archive-card" (click)="viewInvoice(m.$id)">
              
              <div class="card-main-content">
                <div class="card-info">
                  <div class="client-row">
                    <span class="city">
                      {{ m.adresse?.ville }} •  {{ m.adresse?.rue || 'Adresse non renseignée' }} {{ m.adresse?.numero }}
                    </span>
                         <div class="date-detail">
                   {{ m.completedAt | date:'dd/MM/yy' }}
                  </div>
                  </div>

                  <div class="street">
                 
                      {{ m.habitants?.[0]?.nom || m.habitants?.nom || 'Nom' }} 
                      {{ m.habitants?.[0]?.prenom || m.habitants?.prenom || '' }}
                    </div>
                  
             

                  <div class="archive-price">
                     Encaissé : {{ (m.totalFinal || 0) | number:'1.2-2' }}€
                     @if (m.paymentComment) {
                       <span class="comment-text">({{ m.paymentComment }})</span>
                     }
                  </div>
                </div>
                
                <div class="card-actions-right">
                  <button class="btn-delete-archive" (click)="deleteMission($event, m.$id)">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                </div>
              </div>

            </div>
          } @empty {
            <div class="empty-state">Aucun historique de paiement trouvé.</div>
          }
        </div>
      }
    </section>
  </main>

  <nav class="bottom-nav">
    <a (click)="goBack()" class="nav-item">
       <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="8" y1="6" x2="21" y2="6"></line>
        <line x1="8" y1="12" x2="21" y2="12"></line>
        <line x1="8" y1="18" x2="21" y2="18"></line>
        <line x1="3" y1="6" x2="3.01" y2="6"></line>
        <line x1="3" y1="12" x2="3.01" y2="12"></line>
        <line x1="3" y1="18" x2="3.01" y2="18"></line>
      </svg>
      <span>Accueil</span>
    </a>
  </nav>
</div>