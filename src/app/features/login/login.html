<div class="login-page">
  <button (click)="themeService.toggleTheme()" class="theme-btn-float">
    @if (themeService.darkMode()) {
    <svg viewBox="0 0 24 24" width="24">
      <path fill="currentColor"
        d="M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1S11,19.45,11,20z" />
    </svg>
    } @else {
    <svg viewBox="0 0 24 24" width="24">
      <path fill="currentColor"
        d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z" />
    </svg>
    }
  </button>

  <div class="login-card">
    <div class="header">
      <h1>PrimmoFlow</h1>
    </div>

    <div class="form-container">
      @if (step() === 'EMAIL') {
      <div class="step-box">
        <label>E-mail professionnel</label>
        <input type="email" [(ngModel)]="email" (keydown.enter)="handleEmailStep()" 
          (focus)="scrollToInput($event)" placeholder="nom@exemple.com" class="input-field">
        <button (click)="handleEmailStep()" class="btn-primary" [disabled]="loading()">
          {{ loading() ? 'Vérification...' : 'Continuer' }}
        </button>
      </div>
      }

      @if (step() === 'LOGIN') {
      <div class="step-box">
        <p class="status-msg">Bienvenu(e) !</p>
        <label>Mot de passe</label>
        <div class="password-wrapper">
          <input [type]="showPassword() ? 'text' : 'password'" [(ngModel)]="password" 
            (keydown.enter)="onLogin()" (focus)="scrollToInput($event)" placeholder="••••••••" class="input-field">
          <button type="button" class="toggle-password" (click)="showPassword.set(!showPassword())">
            @if (showPassword()) {
            <svg viewBox="0 0 24 24" width="20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
              <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
            } @else {
            <svg viewBox="0 0 24 24" width="20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            }
          </button>
        </div>
        <button (click)="onLogin()" class="btn-primary" [disabled]="loading()">Connexion</button>
        <button (click)="reset()" class="btn-link">Retour / Changer d'e-mail</button>
      </div>
      }

      @if (step() === 'REGISTER') {
      <div class="step-box">
        <p class="status-msg success">Accès autorisé : Finalisez votre profil</p>

<label>Prénom</label>
<input type="text" [(ngModel)]="firstname" (input)="onNameChange()" (focus)="scrollToInput($event)" placeholder="Prénom" class="input-field">

<label>Nom</label>
<input type="text" [(ngModel)]="lastname" (input)="onNameChange()" (focus)="scrollToInput($event)" placeholder="Nom" class="input-field">
        <label>Téléphone professionnel</label>
        <input type="tel" [(ngModel)]="phone" (focus)="scrollToInput($event)" placeholder="+XXYYYYYYYYY" class="input-field">

        <label>Nom d'utilisateur (Pseudo)</label>
        <input type="text" [(ngModel)]="nickName" (focus)="scrollToInput($event)" placeholder="Pseudo" class="input-field">

        <label>Créez votre mot de passe</label>
        <div class="password-wrapper">
          <input [type]="showPassword() ? 'text' : 'password'" [(ngModel)]="password"
            (focus)="scrollToInput($event)" placeholder="6 caractères min." class="input-field">
          <button type="button" class="toggle-password" (click)="showPassword.set(!showPassword())">
            @if (showPassword()) {
              <svg viewBox="0 0 24 24" width="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
            } @else {
              <svg viewBox="0 0 24 24" width="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            }
          </button>
        </div>

        <label>Confirmez votre mot de passe</label>
        <div class="password-wrapper">
          <input [type]="showPassword() ? 'text' : 'password'" [(ngModel)]="confirmPassword"
            (focus)="scrollToInput($event)" (keydown.enter)="isRegisterValid() ? onRegister() : null" 
            placeholder="Répétez le mot de passe" class="input-field" 
            [class.input-error]="confirmPassword && password !== confirmPassword">
        </div>
        
        @if (confirmPassword && password !== confirmPassword) {
          <p class="error-text-inline">Les mots de passe ne correspondent pas.</p>
        }

        <button (click)="onRegister()" class="btn-success" [disabled]="loading() || !isRegisterValid()">
          {{ loading() ? 'Création en cours...' : 'Finaliser mon compte' }}
        </button>

        <button (click)="reset()" class="btn-link">Retour</button>
      </div>
      }
    </div>

    @if (errorMessage()) {
    <div class="error-banner">
      {{ errorMessage() }}
    </div>
    }
  </div>
</div>