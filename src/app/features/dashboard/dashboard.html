<app-dashboard-filters 
  [activeFilter]="activeFilter()" 
  [totalCount]="interventions().length" 
  (filterChange)="setFilter($event)">
</app-dashboard-filters>

@if (showPending()) {
  <section class="recent-activity">
    <h3>En attente ({{ pendingInterventions().length }})</h3>
    <div class="intervention-list">
      @for (inter of pendingInterventions(); track inter.id) {
        <app-intervention-card 
          [intervention]="inter" [statusConfig]="STATUS_CONFIG"
          [canEdit]="true"
          (callOwner)="makePhoneCall($event)"
          [isPressing]="pressedCardId() === inter.id"
          (cardClick)="goToPlanning(inter)" 
          (actionClick)="openTasks(inter, $event)"
          (editClick)="goToEdit($event)"
          (mousedown)="onPressStart(inter)" (mouseup)="onPressEnd()"
          (touchstart)="onPressStart(inter)" (touchend)="onPressEnd()">
        </app-intervention-card>
      }
    </div>
  </section>
}

@if (showPlanned()) {
  <section class="recent-activity">
    <h3>Planifiées ({{ plannedInterventions().length }})</h3>
    <div class="intervention-list">
      @for (inter of plannedInterventions(); track inter.id) {
        <app-intervention-card 
          [intervention]="inter" [statusConfig]="STATUS_CONFIG"
          [canEdit]="false"
          [isPressing]="pressedCardId() === inter.id"
          (cardClick)="goToDetails(inter.id)"
          (actionClick)="goToPlanning(inter, $event)"
          (mousedown)="onPressStart(inter)" (mouseup)="onPressEnd()"
          (touchstart)="onPressStart(inter)" (touchend)="onPressEnd()">
        </app-intervention-card>
      }
    </div>
  </section>
}

@if (showCompleted()) {
  <section class="recent-activity">
    <h3>Terminées ({{ completedInterventions().length }})</h3>
    <div class="intervention-list">
      @for (inter of completedInterventions(); track inter.id) {
        <app-intervention-card 
          [intervention]="inter" [statusConfig]="STATUS_CONFIG"
          [canEdit]="false"
          (callOwner)="makePhoneCall($event)"
          [isPressing]="pressedCardId() === inter.id"
          (cardClick)="inter.status === 'END' ? goToInvoice(inter.id) : (authService.hasPerm('dash_nav_billed') ? markAsPaid(inter, $event) : null)"
          (actionClick)="inter.status === 'END' ? router.navigate(['/history', inter.id]) : null"
          (mousedown)="onPressStart(inter)" (mouseup)="onPressEnd()"
          (touchstart)="onPressStart(inter)" (touchend)="onPressEnd()">
        </app-intervention-card>
      }
    </div>
  </section>
}

@if (selectedIntervention()) {
  <app-task-modal [intervention]="selectedIntervention()!" (close)="closeTasks()"></app-task-modal>
}